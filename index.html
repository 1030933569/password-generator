<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨æ€å¯†ç ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ” åŠ¨æ€å¯†ç ç”Ÿæˆå™¨</h1>
            <p class="subtitle">SHA256 + Base64 åŒé‡åŠ å¯†</p>
        </header>

        <main class="main-content">
            <!-- ä»Šæ—¥å¯†ç å¡ç‰‡ -->
            <div class="card today-card">
                <h2>ğŸ“… ä»Šæ—¥å¯†ç </h2>
                <div class="date-display" id="todayDate">åŠ è½½ä¸­...</div>
                <div class="password-display" id="todayPassword">
                    <span class="password-text">--------</span>
                    <button class="copy-btn" onclick="copyPassword()" title="å¤åˆ¶å¯†ç ">
                        ğŸ“‹
                    </button>
                </div>
                <button class="btn btn-primary" onclick="generateToday()">
                    ğŸ”„ åˆ·æ–°ä»Šæ—¥å¯†ç 
                </button>
            </div>

        </main>

        <!-- åäººåè¨€ -->
        <div class="quote-section" id="quoteSection">
            <p class="quote-text" id="quoteText">"åŠ è½½ä¸­..."</p>
            <p class="quote-author" id="quoteAuthor">â€”â€” </p>
        </div>

        <footer class="footer">
            <p>âš ï¸ è¯·å¦¥å–„ä¿ç®¡æ­¤ç³»ç»Ÿï¼Œä¸è¦æ³„éœ²ç»™éç®¡ç†å‘˜ï¼</p>
        </footer>
    </div>

    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast" id="toast"></div>

    <script>
        // è°ƒç”¨åç«¯ API è·å–å¯†ç 
        async function fetchPassword(date = null) {
            const url = date ? `/api/password?date=${date}` : '/api/password';
            const res = await fetch(url);
            if (!res.ok) throw new Error('è¯·æ±‚å¤±è´¥');
            return res.json();
        }

        // ç”Ÿæˆä»Šæ—¥å¯†ç 
        async function generateToday() {
            try {
                const data = await fetchPassword();
                document.getElementById('todayDate').textContent = data.date;
                document.querySelector('.password-text').textContent = data.password;
            } catch (e) {
                showToast('âŒ è·å–å¯†ç å¤±è´¥');
            }
        }

        // å¤åˆ¶å¯†ç 
        function copyPassword() {
            const pwd = document.querySelector('.password-text').textContent;
            if (pwd && pwd !== '--------') {
                navigator.clipboard.writeText(pwd);
                showToast('âœ… å¯†ç å·²å¤åˆ¶');
            }
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        // ä»åç«¯ API è·å–èƒŒæ™¯å›¾ç‰‡ URL
        async function setRandomBackground() {
            try {
                const res = await fetch('/api/background');
                if (res.ok) {
                    const data = await res.json();
                    document.body.style.backgroundImage = `url('${data.url}')`;
                }
            } catch (e) {
                // å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤æ¸å˜èƒŒæ™¯ï¼ˆCSS å·²å®šä¹‰ï¼‰
                console.log('èƒŒæ™¯åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ¸å˜');
            }
        }

        // è·å–éšæœºåè¨€
        async function fetchQuote() {
            try {
                const res = await fetch('/api/quote');
                if (res.ok) {
                    const data = await res.json();
                    document.getElementById('quoteText').textContent = `"${data.text}"`;
                    document.getElementById('quoteAuthor').textContent = `â€”â€” ${data.author}`;
                }
            } catch (e) {
                console.log('åè¨€åŠ è½½å¤±è´¥');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–ä»Šæ—¥å¯†ç  + è®¾ç½®éšæœºèƒŒæ™¯ + åè¨€
        setRandomBackground();
        generateToday();
        fetchQuote();
    </script>
</body>
</html>